webpackJsonp([17],{1122:function(e,t,a){var o=a(10)(a(1308),a(1710),null,null);e.exports=o.exports},1137:function(e,t,a){var o,r,l;!function(s,i){r=[t,a(61),a(150)],o=i,void 0!==(l="function"==typeof o?o.apply(t,r):o)&&(e.exports=l)}(0,function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var r=o(t),l=o(a),s={data:function(){return{tableParams:{list:[],selectList:[],page:1,pageSize:10,total:0,isCheckBoxClick:!1}}},watch:{},computed:{hasSelect:function(){return!!this.tableParams.selectList.length},tableSelectLength:function(){return this.tableParams.selectList.length},currentPage:function(){return this.tableParams.page},selectedIds:function(){var e=this;return this.tableParams.selectList.map(function(t){return t[e.pk]})}},methods:{loadList:function(){this.$Message.info("请在页面实例重写loadList")},onSearch:function(){this.tableParams.page=1,this.tableParams.selectList=[],this.loadList()},onReset:function(){this.$refs.searchForm&&(this.$refs.searchForm.resetFields(),this.onRangeChange&&"function"==typeof this.onRangeChange&&(this.rangeTime=[],this.onRangeChange([])))},onSelectionChange:function(e){this.tableParams.selectList=(0,l.default)(e),this.tableParams.isCheckBoxClick=!0},onPageChange:function(e){this.tableParams.page=e,this.tableParams.selectList=[],this.loadList()},onPageSizeChange:function(e){this.tableParams.pageSize=e,this.onSearch()},assignQuery:function(e){return(0,r.default)({page:this.tableParams.page,page_size:this.tableParams.pageSize},e)}}};e.default=s})},1147:function(e,t,a){var o,r,l;!function(a,s){r=[],o=s,void 0!==(l="function"==typeof o?o.apply(t,r):o)&&(e.exports=l)}(0,function(){"use strict"})},1193:function(e,t,a){var o,r,l;!function(s,i){r=[t,a(61),a(86),a(495),a(52),a(1147),a(482)],o=i,void 0!==(l="function"==typeof o?o.apply(t,r):o)&&(e.exports=l)}(0,function(e,t,a,o,r,l,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var d=i(t),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(o);i(s);e.default={name:"deptDropDownTree",data:function(){return{treeDeptShow:!1,treeDeptList:[],modelData:{dept_id:"",dept_name:"选择部门"}}},computed:(0,d.default)({},(0,a.mapState)(["userInfo"])),methods:{loadDeptList:function(e){var t=this;n.getAllDeptByUserId({act_user_id:this.userInfo.user_id,user_id:e}).then(function(e){t.treeDeptList=t.buildTreeDept(e.resultObj),null==t.treeDeptList&&(t.treeDeptList=[])})},buildTreeDept:function(e){if(null!=e&&e.length>0){for(var t=e.length,a=[],o=[],r=[],l=0;l<t;l++){var s=e[l],i=s.id,d=s.dept_name,n=(s.total_users,s.children),u=s.is_selected,c={id:i,title:d,expand:!0};u&&"1"==u&&(c.checked=!0,c.selected=!0,o.push(d),r.push(i));var f=this.buildTreeDept(n);null!=f&&f.length>0&&(c.children=f),a[l]=c}return o&&o.length>0?(this.modelData.dept_name=o.join(","),this.modelData.dept_id=r.join(",")):(this.modelData.dept_id="",this.modelData.dept_name="选择部门"),a}return null},getSelected:function(){return this.modelData},setSelected:function(e,t){e?(this.modelData.dept_id=e,this.modelData.dept_name=t):(this.modelData.dept_id="",this.modelData.dept_name="选择部门")},treeDeptOk:function(){this.treeDeptShow=!1;var e=this.$refs.treeDeptObj.getSelectedNodes();if(e&&e.length>0){var t=[],a=[];e.forEach(function(e){t.push(e.title),a.push(e.id)}),this.modelData.dept_name=t.join(","),this.modelData.dept_id=a.join(",")}this.$emit("onDeptSelect",this.modelData)}},created:function(){this.loadDeptList()}}})},1194:function(e,t,a){var o,r,l;!function(s,i){r=[t,a(61),a(86),a(496),a(52),a(1147),a(482)],o=i,void 0!==(l="function"==typeof o?o.apply(t,r):o)&&(e.exports=l)}(0,function(e,t,a,o,r,l,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var d=i(t),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(o);i(s);e.default={name:"roleDropDownTree",data:function(){return{treeRoleShow:!1,treeRoleList:[],modelData:{role_id:"",role_name:"选择角色"}}},computed:(0,d.default)({},(0,a.mapState)(["userInfo"])),methods:{loadRoleList:function(e){var t=this;n.getAllRoleListApi({act_user_id:this.userInfo.user_id,user_id:e}).then(function(e){t.treeRoleList=t.buildTreeRole(e.resultObj),null==t.treeRoleList&&(t.treeRoleList=[])})},buildTreeRole:function(e){if(null!=e&&e.length>0){for(var t=e.length,a=[],o=[],r=0;r<t;r++){var l=e[r],s=l.role_id,i=l.role_name,d=l.children,n=l.is_selected,u={id:s,title:i};n&&"1"==n&&(u.checked=!0,u.selected=!0,o.push(i));var c=this.buildTreeRole(d);null!=c&&c.length>0&&(u.children=c),a[r]=u}return o&&o.length>0?this.modelData.role_name=o.join(","):(this.modelData.role_name="选择角色",this.modelData.role_id=""),a}return null},getSelected:function(){return this.modelData},setSelected:function(e,t){e?(this.modelData.role_id=e,this.modelData.role_name=t):(this.modelData.role_name="选择角色",this.modelData.role_id="")},treeRoleOk:function(){this.treeRoleShow=!1;var e=this.$refs.treeRoleObj.getSelectedNodes();if(e&&e.length>0){var t=[],a=[];e.forEach(function(e){t.push(e.title),a.push(e.id)}),this.modelData.role_name=t.join(","),this.modelData.role_id=a.join(",")}this.$emit("onRoleSelect",this.modelData)}},watch:{},created:function(){this.loadRoleList()}}})},1203:function(e,t,a){t=e.exports=a(1083)(),t.push([e.i,".wm-ivu-tree{height:auto;max-height:200px;overflow:auto}","",{version:3,sources:["/Users/ganqiantai/Desktop/gitWork/wm/tms-web/src/components/system/v2/deptDropDownTree.vue"],names:[],mappings:"AACA,aACE,YAAa,AACb,iBAAkB,AAClB,aAAe,CAChB",file:"deptDropDownTree.vue",sourcesContent:["\n.wm-ivu-tree {\n  height: auto;\n  max-height: 200px;\n  overflow: auto;\n}\n"],sourceRoot:""}])},1205:function(e,t,a){t=e.exports=a(1083)(),t.push([e.i,".wm-ivu-tree{height:auto;max-height:200px;overflow:auto}","",{version:3,sources:["/Users/ganqiantai/Desktop/gitWork/wm/tms-web/src/components/system/v2/roleDropDownTree.vue"],names:[],mappings:"AACA,aACE,YAAa,AACb,iBAAkB,AAClB,aAAe,CAChB",file:"roleDropDownTree.vue",sourcesContent:["\n.wm-ivu-tree {\n  height: auto;\n  max-height: 200px;\n  overflow: auto;\n}\n"],sourceRoot:""}])},1208:function(e,t,a){var o=a(1203);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(1084)("5be7a530",o,!0)},1210:function(e,t,a){var o=a(1205);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(1084)("f43d4652",o,!0)},1215:function(e,t,a){a(1208);var o=a(10)(a(1193),a(1224),null,null);e.exports=o.exports},1216:function(e,t,a){a(1210);var o=a(10)(a(1194),a(1228),null,null);e.exports=o.exports},1224:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Dropdown",{attrs:{trigger:"custom",visible:e.treeDeptShow,width:"100%",height:"50"}},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){e.treeDeptShow=!e.treeDeptShow}}},[e._v("\n                "+e._s(e.modelData.dept_name)+"\n                "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),e._v(" "),a("Dropdown-menu",{staticStyle:{"margin-left":"10px"},attrs:{slot:"list"},slot:"list"},[a("Tree",{ref:"treeDeptObj",staticClass:"wm-ivu-tree",attrs:{data:e.treeDeptList}}),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"10px"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.treeDeptOk}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]}},1228:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Dropdown",{attrs:{trigger:"custom",visible:e.treeRoleShow,width:"100%"}},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(t){e.treeRoleShow=!e.treeRoleShow}}},[e._v("\n                "+e._s(e.modelData.role_name)+"\n                "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),e._v(" "),a("Dropdown-menu",{staticStyle:{"margin-left":"10px"},attrs:{slot:"list"},slot:"list"},[a("Tree",{ref:"treeRoleObj",staticClass:"wm-ivu-tree",attrs:{data:e.treeRoleList}}),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"10px"}},[a("Button",{attrs:{type:"primary",size:"small"},on:{click:e.treeRoleOk}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]}},1308:function(e,t,a){var o,r,l;!function(s,i){r=[t,a(61),a(86),a(1137),a(503),a(52),a(1147),a(482),a(1215),a(1216)],o=i,void 0!==(l="function"==typeof o?o.apply(t,r):o)&&(e.exports=l)}(0,function(e,t,a,o,r,l,s,i,d,n){"use strict";function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var c=u(t),f=u(o),m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(r),p=u(i),h=u(d),_=u(n),v=function(e,t,a){var o=/^[\x21-\x5e\x60-\x7e][\x21-\x7e]{5,19}$/g;""==t||o.test(t)?a():a(new Error("请输入正确的密码格式"))},D={user_name:[p.default.required({message:"姓名不能为空"}),p.default.max({max:20,message:"姓名不能为空"})],user_mobile:[p.default.required({message:"手机号不能为空"}),{validator:p.default.phone,message:"请输入正确的手机号",trigger:"blur"}],user_pwd:[p.default.required({message:"密码不能为空"}),p.default.max({max:20,message:"密码不能超过20字符"}),p.default.min({min:6,message:"密码不能少于6字符"}),{validator:v,message:"请输入正确的密码",trigger:"blur"}],pwd:[p.default.required({message:"密码不能为空"}),p.default.max({max:20,message:"密码不能超过20字符"}),p.default.min({min:6,message:"密码不能少于6字符"}),{validator:v,message:"请输入正确的密码",trigger:"blur"}],dept_id:[p.default.required({message:"部门不能为空"})],role_id:[p.default.required({message:"角色不能为空"})]};e.default={name:"staffList",data:function(){var e=this;return{ruleValidate:D,columns:[{title:"登录帐号",key:"user_mobile",width:250},{title:"姓名",key:"user_name",width:200},{title:"手机号",key:"user_mobile",width:250},{title:"用户状态",key:"user_status",render:function(e,t){return e("span",{Y:"启用",N:"禁用"}[t.row.user_status])}},{title:"操作",key:"user_status",width:300,render:function(t,a){return t("div",[t("a",{on:{click:function(){return e.editStaff(a.row)}}},"编辑"),t("a",{on:{click:function(){return e.resetPwd(a.row)}},style:{marginLeft:"15px"}},"重置密码"),t("a",{on:{click:function(){return e.toggleStatus(a.row)}},style:{marginLeft:"15px"}},"Y"==a.row.user_status?"禁用":"启用"),t("a",{on:{click:function(){return e.delStaff(a.row)}},style:{marginLeft:"15px"}},"删除")])}}],addModal:{modal:!1,modalData:{user_name:"",user_mobile:"",user_pwd:"",role_id:"",dept_id:""}},editModal:{modal:!1,modalData:{user_name:"",role_id:"",user_id:"",dept_id:""}},resetModal:{modal:!1,modalData:{user_name:"",pwd:"",user_pwd:"",role_id:"",user_id:""}},delModal:{modal:!1,modalData:{user_id:null}}}},mixins:[f.default],computed:(0,c.default)({},(0,a.mapState)(["userInfo"])),components:{deptDropDownTree:h.default,roleDropDownTree:_.default},methods:{loadList:function(){var e=this,t=this.assignQuery({act_user_id:this.userInfo.user_id});m.getStaffListApi(t).then(function(t){e.tableParams.list=t.resultObj.list,e.tableParams.total=t.resultObj.count})},addStaff:function(){this.$refs.addStaffForm.resetFields(),this.addModal.modal=!0,this.$refs.deptDropDownTree.loadDeptList(""),this.$refs.roleDropDownTree.loadRoleList("")},saveAddStaff:function(){var e=this;this.$refs.addStaffForm.validate(function(t){if(!t)return e.addModal.modal=!0,void(e.$refs.addStaffModel.visible=!0);var a=(0,c.default)({},e.addModal.modalData,{act_user_id:e.userInfo.user_id});m.staffAddApi(a).then(function(t){e.$Message.success(t.resultObj),e.loadList()})})},editStaff:function(e){this.editModal.modal=!0,this.$refs.editStaffForm.resetFields(),(0,l.copySameNamePropety)(this.editModal.modalData,e),this.$refs.editDeptDropDownTree.setSelected(e.dept_id,e.dept_name),this.$refs.editRoleDropDownTree.setSelected(e.role_id,e.role_name)},saveEditStaff:function(){var e=this;this.$refs.editStaffForm.validate(function(t){if(t){var a=(0,c.default)({},e.editModal.modalData,{act_user_id:e.userInfo.user_id});m.staffUpdateApi(a).then(function(t){e.$Message.success(t.resultObj),e.loadList()})}else e.editModal.modal=!0,e.$refs.editStaffModel.visible=!0})},delStaff:function(e){this.delModal.modal=!0,this.delModal.modalData.user_id=e.user_id},delStaffOk:function(){var e=this,t={act_user_id:this.userInfo.user_id,company_id:this.userInfo.company_id,user_id:this.delModal.modalData.user_id};m.staffDelApi(t).then(function(t){e.$Message.success("删除成功"),e.loadList()})},resetPwd:function(e){this.resetModal.modal=!0,this.$refs.resetForm.resetFields(),(0,l.copySameNamePropety)(this.resetModal.modalData,e)},saveResetPwd:function(){var e=this;this.$refs.resetForm.validate(function(t){if(!t)return e.resetModal.modal=!0,void(e.$refs.resetPwdModel.visible=!0);if(e.resetModal.modalData.pwd!=e.resetModal.modalData.user_pwd)return e.$Message.error("两次密码输入不一致！");var a=(0,c.default)({},e.resetModal.modalData,{act_user_id:e.userInfo.user_id});m.staffResetApi(a).then(function(t){e.$Message.success(t.resultObj),e.hideModel("resetModal","modal"),e.loadList()})})},hideModel:function(e,t){this[e][t]=!1},toggleStatus:function(e){var t=this,a={Y:"是否确定禁用该用户？",N:"是否确定启用该用户？"},o={user_id:e.user_id,act_user_id:this.userInfo.user_id,user_status:"Y"==e.user_status?"N":"Y"};this.$Modal.confirm({content:a[e.user_status]||"确定该操作",onOk:function(){var a=this;if(e.user_id==t.userInfo.user_id)return this.$Message.error("无法禁用当前账户！");m.setStaffStateApi(o).then(function(e){t.loadList(),a.$Message.success(e.resultInfo)})}})},onDeptSelect:function(e){e&&(this.addModal.modalData.dept_id=e.dept_id,this.editModal.modalData.dept_id=e.dept_id)},onRoleSelect:function(e){e&&(this.addModal.modalData.role_id=e.role_id+"",this.editModal.modalData.role_id=e.role_id+"")}},created:function(){this.loadList()}}})},1710:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"contain-head"},[a("i-button",{attrs:{type:"primary"},on:{click:e.addStaff}},[e._v("新增员工")])],1),e._v(" "),a("div",{staticClass:"contain-main"},[a("i-table",{attrs:{data:e.tableParams.list,columns:e.columns},on:{"on-selection-change":e.onSelectionChange}}),e._v(" "),a("div",{staticClass:"page-wrapper"},[a("Page",{attrs:{total:e.tableParams.total,"show-sizer":"","show-elevator":"",current:e.currentPage},on:{"on-change":e.onPageChange,"on-page-size-change":e.onPageSizeChange}})],1)],1),e._v(" "),a("Modal",{ref:"addStaffModel",attrs:{title:"新增"},on:{"on-ok":e.saveAddStaff},model:{value:e.addModal.modal,callback:function(t){e.$set(e.addModal,"modal",t)},expression:"addModal.modal"}},[a("Form",{ref:"addStaffForm",attrs:{rules:e.ruleValidate,model:e.addModal.modalData,"label-width":100}},[a("Form-item",{attrs:{label:"姓名：",prop:"user_name"}},[a("i-input",{attrs:{placeholder:"输入员工姓名"},model:{value:e.addModal.modalData.user_name,callback:function(t){e.$set(e.addModal.modalData,"user_name",t)},expression:"addModal.modalData.user_name"}})],1),e._v(" "),a("Form-item",{attrs:{label:"部门：",prop:"dept_id"}},[a("dept-drop-down-tree",{ref:"deptDropDownTree",on:{onDeptSelect:e.onDeptSelect},model:{value:e.addModal.modalData.dept_id,callback:function(t){e.$set(e.addModal.modalData,"dept_id",t)},expression:"addModal.modalData.dept_id"}})],1),e._v(" "),a("Form-item",{attrs:{label:"角色：",prop:"role_id"}},[a("role-drop-down-tree",{ref:"roleDropDownTree",on:{onRoleSelect:e.onRoleSelect},model:{value:e.addModal.modalData.role_id,callback:function(t){e.$set(e.addModal.modalData,"role_id",t)},expression:"addModal.modalData.role_id"}})],1),e._v(" "),a("Form-item",{attrs:{label:"手机号：",prop:"user_mobile"}},[a("i-input",{attrs:{placeholder:"输入员工手机号"},model:{value:e.addModal.modalData.user_mobile,callback:function(t){e.$set(e.addModal.modalData,"user_mobile",t)},expression:"addModal.modalData.user_mobile"}})],1),e._v(" "),a("Form-item",{attrs:{label:"密码：",prop:"user_pwd"}},[a("i-input",{attrs:{type:"password",placeholder:"输入员工密码"},model:{value:e.addModal.modalData.user_pwd,callback:function(t){e.$set(e.addModal.modalData,"user_pwd",t)},expression:"addModal.modalData.user_pwd"}})],1)],1)],1),e._v(" "),a("Modal",{ref:"editStaffModel",attrs:{title:"修改"},on:{"on-ok":e.saveEditStaff},model:{value:e.editModal.modal,callback:function(t){e.$set(e.editModal,"modal",t)},expression:"editModal.modal"}},[a("Form",{ref:"editStaffForm",attrs:{rules:e.ruleValidate,model:e.editModal.modalData,"label-width":100}},[a("Form-item",{attrs:{label:"姓名：",prop:"user_name"}},[a("i-input",{attrs:{placeholder:"输入员工姓名"},model:{value:e.editModal.modalData.user_name,callback:function(t){e.$set(e.editModal.modalData,"user_name",t)},expression:"editModal.modalData.user_name"}})],1),e._v(" "),a("Form-item",{attrs:{label:"部门：",prop:"dept_id"}},[a("dept-drop-down-tree",{ref:"editDeptDropDownTree",on:{onDeptSelect:e.onDeptSelect},model:{value:e.editModal.modalData.dept_id,callback:function(t){e.$set(e.editModal.modalData,"dept_id",t)},expression:"editModal.modalData.dept_id"}})],1),e._v(" "),a("Form-item",{attrs:{label:"角色：",prop:"role_id"}},[a("role-drop-down-tree",{ref:"editRoleDropDownTree",on:{onRoleSelect:e.onRoleSelect},model:{value:e.editModal.modalData.role_id,callback:function(t){e.$set(e.editModal.modalData,"role_id",t)},expression:"editModal.modalData.role_id"}})],1)],1)],1),e._v(" "),a("Modal",{ref:"resetPwdModel",attrs:{title:"重置密码"},on:{"on-ok":e.saveResetPwd},model:{value:e.resetModal.modal,callback:function(t){e.$set(e.resetModal,"modal",t)},expression:"resetModal.modal"}},[a("Form",{ref:"resetForm",attrs:{rules:e.ruleValidate,model:e.resetModal.modalData,"label-width":100}},[a("Form-item",{attrs:{label:"新密码：",prop:"pwd"}},[a("i-input",{attrs:{type:"password",placeholder:"输入新密码"},model:{value:e.resetModal.modalData.pwd,callback:function(t){e.$set(e.resetModal.modalData,"pwd",t)},expression:"resetModal.modalData.pwd"}}),e._v(" "),a("span",{staticStyle:{color:"gray"}},[e._v("长度6-20位，只能包含字母、数字及标点符号")])],1),e._v(" "),a("Form-item",{attrs:{label:"重复密码：",prop:"user_pwd"}},[a("i-input",{attrs:{type:"password",placeholder:"再次输入新密码"},model:{value:e.resetModal.modalData.user_pwd,callback:function(t){e.$set(e.resetModal.modalData,"user_pwd",t)},expression:"resetModal.modalData.user_pwd"}})],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:function(t){e.hideModel("resetModal","modal")}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.saveResetPwd}},[e._v("确定")])],1)],1),e._v(" "),a("Modal",{attrs:{title:"系统提示"},on:{"on-ok":e.delStaffOk},model:{value:e.delModal.modal,callback:function(t){e.$set(e.delModal,"modal",t)},expression:"delModal.modal"}},[a("p",[e._v("您是否确认删除该用户")])])],1)},staticRenderFns:[]}}});
//# sourceMappingURL=17.d8725b4a87de11fb386e.js.map